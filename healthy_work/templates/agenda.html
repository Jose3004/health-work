<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Healthy-Work | Agendar Cita</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
        <h2>Healthy-Work</h2>
        <nav>
            <ul>
                
                {# Enlace de Inicio #}
                <li>
                    <a href="{{ url_for('dashboard') }}" 
                       {% if request.endpoint == 'dashboard' %}class="active"{% endif %}>
                        <i class="fas fa-home sidebar-icon"></i>
                        Inicio
                    </a>
                </li>
                
                {# Enlace de Perfil #}
                <li>
                    <a href="{{ url_for('perfil') }}" 
                       {% if request.endpoint == 'perfil' %}class="active"{% endif %}>
                        <i class="fas fa-user sidebar-icon"></i>
                        Perfil
                    </a>
                </li>
                
                {# Enlace de Manejo de Emociones #}
                <li>
                    <a href="{{ url_for('emociones') }}" 
                       {% if request.endpoint == 'emociones' %}class="active"{% endif %}>
                        <i class="fas fa-brain sidebar-icon"></i>
                        Manejo de emociones
                    </a>
                </li>
                
                {# Enlace de Recursos #}
                <li>
                    <a href="{{ url_for('recursos') }}" 
                       {% if request.endpoint == 'recursos' %}class="active"{% endif %}>
                        <i class="fas fa-book-reader sidebar-icon"></i>
                        Recursos ansiedad/depresión
                    </a>
                </li>
                
                {# Enlace de Agenda de Citas #}
                <li>
                    <a href="{{ url_for('agenda') }}" 
                       {% if request.endpoint == 'agenda' %}class="active"{% endif %}>
                        <i class="fas fa-calendar-alt sidebar-icon"></i>
                        Agenda de citas
                    </a>
                </li>
                
                {# Enlace de Cerrar Sesión #}
                <li>
                    <a href="{{ url_for('login') }}">
                        <i class="fas fa-sign-out-alt sidebar-icon"></i>
                        Cerrar sesión
                    </a>
                </li>
                
            </ul>
        </nav>
    </aside>
    <!-- Contenido principal -->
    <main class="main-content">
      <!-- MENSAJES FLASH -->
    {% with mensajes = get_flashed_messages(with_categories=true) %}
      {% if mensajes %}
        <div class="flash-container">
          {% for categoria, mensaje in mensajes %}
            <div class="flash {{ categoria }}">{{ mensaje }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

        <div class="agenda-section">

        <h2>Agendar cita</h2>

        <p class="psychologist">
            Psicólogo asignado: <strong>Ana Torres</strong>
        </p>

        <form method="POST" class="agenda-form">

            <label for="fecha">Selecciona una fecha:</label>
            <input type="date"
                  id="fecha"
                  name="fecha"
                  required
                  min="{{ hoy }}"
                  >  <!-- Envía la fecha para recargar horarios -->
            <!-- Script que bloquea fines de semana -->
            <script>
            document.addEventListener("DOMContentLoaded", function () {
                const fecha = document.getElementById("fecha");

                fecha.addEventListener("input", () => {
                    const dia = new Date(fecha.value + "T00:00:00").getDay();

                    if (dia === 0 || dia === 6) {
                        fecha.setCustomValidity("No se pueden agendar citas los fines de semana.");
                        fecha.reportValidity();
                        fecha.value = "";
                    } else {
                        fecha.setCustomValidity("");
                    }
                });
            });
            </script>


            <label for="hora">Horarios disponibles:</label>
            {% if sin_horarios %}
              <p>No hay horarios disponibles para este día.</p>
            {% else %}
                <label for="hora">Hora:</label>
                <select name="hora" id="hora" required>
                    {% for h in horarios_libres %}
                        <option value="{{ h }}">{{ h }}</option>
                    {% endfor %}
                </select>
            {% endif %}


            <button type="submit" class="btn">Agendar cita</button>

        </form>
      </div>

      <!-- Lista de citas -->
      <div class="table-container">
          <h3>Mis citas agendadas</h3>
          <table>
              <thead>
                  <tr>
                      <th>Fecha</th>
                      <th>Hora</th>
                      <th>Motivo</th>
                  </tr>
              </thead>
              <tbody>
                  {% for cita in citas %}
                  <tr>
                      <td>{{ cita['fecha'] }}</td>
                      <td>{{ cita['hora'] }}</td>
                      <td>{{ cita['motivo'] }}</td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
